### 1.单机
    保证一定的持久化

    缺点:
        单机、容量、qps

### 2.主从复制
    提升qps

    多节点，分为主从，主服务节点-->从服务节点【Master每执行一个写命令就会向Slave发送相同的写命令】
        容量、单机

    缺陷：
        主节点故障，需要人工干预
            -->需要手动将一个从节点晋升为主节点，同时需要修改应用方的主节点地址，还需要命令从其他从节点复制新的主节点。
        主节点的写能力受到单机的限制，写操作无法负载均衡
        主节点的存储能力受到单机的限制

    
#### 搭建
    https://www.cnblogs.com/xiaoxian1369/p/4663973.html
    (1)启动后配置
        salveof host port【丢弃旧的数据，同时会触发数据同步】
        状态查询：
            info
            info replication

                # Replication
                role:master

                # Replication
                role:slave

        加入有密码：
            config set masterauth redis         

    (2)启动前配置-->配置文件
    (3)脱离-->可以用于主机故障，从机继任。
        slaveof no one
        
        利用『 SLAVEOF NO ONE 不会丢弃同步所得数据集』这个特性，
        可以在主服务器失败的时候，将从属服务器用作新的主服务器，从而实现无间断运行。

    (4)数据同步
        sync 和 psync
        主从刚刚连接的时候，进行全量同步；全同步结束后，进行增量同步。当然，如果有需要，slave 在任何时候都可以发起全量同步。
        redis 策略是，无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步。  

        多节点全量同步会导致master IO飙高。         
### 3.哨兵
    https://www.cnblogs.com/kismetv/p/9609938.html#t11
    增加哨兵节点，哨兵节点也是一个salver节点 -->用于监控
    
#### 自动故障转移

    # Generated by CONFIG REWRITE
    maxmemory 3gb
    sentinel config-epoch mymaster 0
    sentinel leader-epoch mymaster 0
    sentinel known-slave mymaster 127.0.0.1 6380
    sentinel known-slave mymaster 127.0.0.1 26380
    sentinel known-slave mymaster 127.0.0.1 6381
    sentinel known-sentinel mymaster 127.0.0.1 26380 b45996448319331fbd1d750441f211732267de92
    sentinel current-epoch 0

    主节点6379挂掉一会并重启：
    6380 成了新主节点，salveof配置被删除，6379成了从节点，配置多了slaveof。
    sentinel current-epoch 0->1 表示第二个纪元。

    maxmemory 3gb
    sentinel config-epoch mymaster 1
    sentinel leader-epoch mymaster 1
    sentinel known-slave mymaster 127.0.0.1 6379
    sentinel known-slave mymaster 127.0.0.1 6381
    sentinel known-slave mymaster 127.0.0.1 26380
    sentinel known-sentinel mymaster 127.0.0.1 26380 b45996448319331fbd1d750441f211732267de92
    sentinel current-epoch 1

#### 原理
    (1)定时任务
        主节点->info获取节点列表
        ping其他节点
        发布订阅获取其他节点信息
    (2)主观下线    
    (3)判断下线哨兵达到一定数目后，进行客观下线
        sentinel is-master-down-by-addr
        选举领导者哨兵节点：当主节点被判断客观下线以后，各个哨兵节点会进行协商，选举出一个领导者哨兵节点，并由该领导者节点对其进行故障转移操作。
        
    (4)选举新主
        使用raft
        slaveof no one 从-->主
### 4.集群
    https://www.cnblogs.com/kismetv/p/9609938.html#t11
    https://www.cnblogs.com/esofar/p/10486621.html

    (1)数据分区
        可以分区解决单机存储容量问题，可以进行写负载均衡
    
    (2)高可用
        (槽指派/重新分片/故障转移)


#### 手动搭建
    (1)配置和启动节点
        bind 192.168.83.128                    # 设置当前节点主机地址       
        port 7001                              # 设置客户端连接监听端口     
        pidfile /var/run/redis_7001.pid        # 设置 Redis 实例 pid 文件       
        daemonize yes                          # 以守护进程运行 Redis 实例     
        cluster-enabled yes                    # 启用集群模式
        cluster-node-timeout 15000             # 设置当前节点连接超时毫秒数
        cluster-config-file nodes-7001.conf    # 设置当前节点集群配置文件路径
    
    (2)节点握手
        cluster meet ip port  
    
    (3)分配槽位--slot  
        /usr/local/bin/redis-cli -p 7001 cluster addslots {0..5461}
        /usr/local/bin/redis-cli -p 7002 cluster addslots {5462..10922}
        /usr/local/bin/redis-cli -p 7003 cluster addslots {10923..16383}
    (4)主从复制
        给从节点设置主节点
        cluster replicate node-id    

#### 主动搭建        
redis-trib.rb 是 Redis 作者使用 Ruby 语言开发的
Redis 5.0 版本 redis-cli --cluster


